(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{329:function(e,t,n){},363:function(e,t,n){"use strict";n(329)},370:function(e,t,n){"use strict";n.r(t);n(357),n(358),n(103);var i=n(62),r=n(361),s=n(362),o={name:"VRImage",props:{title:{type:String,default:!1},src:{type:String,required:!0}},data:function(){return{mode:"default",fullscreenIcon:["fas","expand"],fov:75,camera:null,scene:null,renderer:null,raycaster:null,mouse:null,intersects:null,isUserIntefacing:!1,down:{x:0,y:0,lon:0,lat:0},lon:0,lat:0}},computed:{source:function(){return this.$site.base+this.src.substring(1)}},methods:{init:function(){var e=this.width/this.height;this.camera=new r.e(this.fov,e,1,1100),this.lon=15,this.scene=new r.g;var t=(new r.i).load(this.source);t.mapping=r.a,this.scene.background=t;var n=new r.h(1,60,40),i=(new r.i).load("/assets/img/vr/kitchen.jpg"),o=new r.d({map:i,transparent:!0,opacity:.5}),a=new r.c(n,o);a.position.z=2,a.position.x=20,a.position.y=-1,a.rotation.y=.5*Math.PI,console.log("DEBUG","locationMesh - uuid",a.uuid),this.scene.add(a),this.renderer=new r.l({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.xr.enabled=!0,this.renderer.xr.setReferenceSpaceType("local"),this.$refs.container.appendChild(this.renderer.domElement),this.$refs.container.appendChild(s.a.createButton(this.renderer)),this.raycaster=new r.f,this.mouse=new r.j,this.$refs.container.addEventListener("pointerdown",this.onPointerDown),this.$refs.container.addEventListener("wheel",this.onMouseWheel),this.$refs.container.addEventListener("resize",this.onWindowResize),this.$refs.container.addEventListener("mousemove",this.onMouseMove),this.$refs.container.addEventListener("click",this.onClick),this.renderer.setAnimationLoop(this.render)},animate:function(){window.requestAnimationFrame(this.animate),this.updateScene()},render:function(){this.raycaster.setFromCamera(this.mouse,this.camera),this.intersects=this.raycaster.intersectObjects(this.scene.children);for(var e=0;e<this.scene.children.length;e++)this.scene.children[e].scale=new r.k(1,1,1),this.scene.children[e].material.opacity=.5;for(var t=0;t<this.intersects.length;t++)this.intersects[t].object.scale=new r.k(2,2,2),this.intersects[t].object.material.opacity=1;this.renderer.render(this.scene,this.camera)},updateScene:function(){this.lat=Math.max(-85,Math.min(85,this.lat));var e=r.b.degToRad(90-this.lat),t=r.b.degToRad(this.lon),n=500*Math.sin(e)*Math.cos(t),i=500*Math.cos(e),s=500*Math.sin(e)*Math.sin(t);this.camera.lookAt(n,i,s),this.renderer.render(this.scene,this.camera)},updateSize:function(){var e=this.$refs.root.getBoundingClientRect().width;this.width=e,this.height=9*e/16},updateRendererSize:function(){this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)},resetSize:function(){var e=this.$refs.root.parentNode.getBoundingClientRect().width;this.width=e,this.height=9*e/16},onWindowResize:function(){this.updateSize(),this.updateRendererSize()},onPointerDown:function(e){!1!==e.isPrimary&&(this.isUserIntefacing=!0,this.down.x=e.clientX,this.down.y=e.clientY,this.down.lon=this.lon,this.down.lat=this.lat,window.document.addEventListener("pointermove",this.onPointerMove),window.document.addEventListener("pointerup",this.onPointerUp))},onPointerMove:function(e){!1!==e.isPrimary&&(this.lon=.1*(this.down.x-e.clientX)+this.down.lon,this.lat=.1*(e.clientY-this.down.y)+this.down.lat)},onPointerUp:function(e){!1!==e.isPrimary&&(this.isUserIntefacing=!1,window.document.removeEventListener("pointermove",this.onPointerMove),window.document.removeEventListener("pointerup",this.onPointerUp))},onMouseWheel:function(e){e.preventDefault(),this.fov=Number(this.camera.fov+.05*e.deltaY).toFixed(0),this.camera.fov=r.b.clamp(this.fov,10,75),this.camera.updateProjectionMatrix()},onMouseMove:function(e){this.mouse.x=e.offsetX/this.width*2-1,this.mouse.y=-e.offsetY/this.height*2+1},onClick:function(e){console.log("DEBUG",this.intersects.length,this.intersects);for(var t=0;t<this.intersects.length;t++)console.log("DEBUG","uuid",this.intersects[t].object.uuid)},onClickFullscreen:function(e){var t=this;return Object(i.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("default"!==t.mode){e.next=5;break}return e.next=3,t.enterFullScreen();case 3:e.next=6;break;case 5:t.resetFullScreen();case 6:case"end":return e.stop()}}),e)})))()},enterFullScreen:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("fullscreen"!==e.mode){t.next=2;break}return t.abrupt("return");case 2:return e.mode="fullscreen",e.fullscreenIcon=["fas","compress"],e.width=window.screen.width,e.height=window.screen.height,e.updateRendererSize(),e.$refs.root.classList.add("fullscreen"),t.next=10,e.$refs.root.requestFullscreen();case 10:case"end":return t.stop()}}),t)})))()},resetFullScreen:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("default"!==e.mode){t.next=2;break}return t.abrupt("return");case 2:e.mode="default",e.fullscreenIcon=["fas","expand"],e.resetSize(),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix(),e.renderer.setSize(e.width,e.height),e.$refs.root.classList.remove("fullscreen"),window.document.fullscreenElement&&window.document.exitFullscreen();case 10:case"end":return t.stop()}}),t)})))()},onFullscreenChange:function(e){var t=this;return Object(i.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.document.fullscreenElement){e.next=3;break}return e.next=3,t.resetFullScreen();case 3:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.updateSize(),this.init(),this.animate(),window.document.addEventListener("fullscreenchange",this.onFullscreenChange)},beforeDestroy:function(){window.document.removeEventListener("fullscreenchange",this.onFullscreenChange)}},a=(n(363),n(41)),c=Object(a.a)(o,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{ref:"root",staticClass:"root"},[t("div",{ref:"container",staticClass:"container"}),this._v(" "),t("button",{staticClass:"fullscreen-toggle",on:{click:this.onClickFullscreen}},[t("font-awesome-icon",{attrs:{icon:this.fullscreenIcon}})],1)])}),[],!1,null,"aa752bda",null);t.default=c.exports}}]);